<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Callsign Search</title>
</head>
<body>
    <h2>Search HAM Callsign</h2>
    <input type="text" id="searchBox" placeholder="Enter Callsign" oninput="searchCallsign()">
    <div id="result"></div>

    <script>
        let data = []; // The data will be loaded from an external JSON file

        // Function to load the data from an external JSON file
        function loadData() {
            fetch('callsign2country.json')
                .then(response => response.json())
                .then(jsonData => {
                    data = jsonData;
                })
                .catch(error => {
                    console.error('Error loading JSON data:', error);
                });
        }

        // Function to compare two prefix strings
        function comparePrefixes(prefix1, prefix2) {
            return prefix1.localeCompare(prefix2);
        }

        // Function to check if the input starts with the prefix
        function startsWith(input, prefix) {
            return prefix.startsWith(input);
        }

        // Function to check if the input falls between two prefixes
        function isBetween(input, start, end) {
            return comparePrefixes(input, start) >= 0 && comparePrefixes(input, end) <= 0;
        }

        // Function to search the callsign
        function searchCallsign() {
            const input = document.getElementById('searchBox').value.toUpperCase();
            let resultHTML = '';
            let foundExactMatch = false;
            let foundStartsWith = false;

            // Clear the result if search box is empty
            if (input.length === 0) {
                document.getElementById('result').innerHTML = '';
                return;
            }

            data.forEach(item => {
                // Check if input is in the assigned range
                if (isBetween(input, item.assigned_range_start, item.assigned_range_end)) {
                    foundExactMatch = true;
                    resultHTML += `<p>Found in: ${item.geographical_place}</p>`;

                    // Check in used_prefixes array
                    item.used_prefixes.forEach(prefix => {
                        if (isBetween(input, prefix.used_prefix_start, prefix.used_prefix_end)) {
                            resultHTML += `<p>Exact Match: ${prefix.geographical_place} (ITU: ${prefix.zone_itu}, CQ: ${prefix.zone_cq})</p>`;
                        }
                    });
                }
            });

            // If no exact match, list all assigned ranges that start with the input (used_prefixes are skipped)
            if (!foundExactMatch) {
                data.forEach(item => {
                    if (startsWith(item.assigned_range_start, input) || startsWith(input, item.assigned_range_start)) {
                        foundStartsWith = true;
                        resultHTML += `<p>Starts with '${input}' in range: ${item.assigned_range_start} - ${item.assigned_range_end} (${item.geographical_place})</p>`;
                    }
                });
            }

            if (!foundExactMatch && !foundStartsWith) {
                resultHTML = '<p>No match found</p>';
            }

            document.getElementById('result').innerHTML = resultHTML;
        }

        // Load the data when the page is ready
        window.onload = loadData;
    </script>
</body>
</html>
